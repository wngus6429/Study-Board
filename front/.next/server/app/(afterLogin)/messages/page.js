(()=>{var e={};e.id=664,e.ids=[664],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},81801:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>g,tree:()=>d}),r(72958),r(60246),r(91884),r(59198);var a=r(30170),s=r(45002),n=r(83876),i=r.n(n),o=r(66299),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d=["",{children:["(afterLogin)",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,72958)),"C:\\Users\\wngus\\Documents\\Study-Board\\front\\src\\app\\(afterLogin)\\messages\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e),async e=>(await Promise.resolve().then(r.bind(r,71150))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,60246)),"C:\\Users\\wngus\\Documents\\Study-Board\\front\\src\\app\\layout.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,91884)),"C:\\Users\\wngus\\Documents\\Study-Board\\front\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,59198)),"C:\\Users\\wngus\\Documents\\Study-Board\\front\\src\\app\\not-found.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e),async e=>(await Promise.resolve().then(r.bind(r,71150))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["C:\\Users\\wngus\\Documents\\Study-Board\\front\\src\\app\\(afterLogin)\\messages\\page.tsx"],u="/(afterLogin)/messages/page",x={require:r,loadChunk:()=>Promise.resolve()},g=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(afterLogin)/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},63843:(e,t,r)=>{Promise.resolve().then(r.bind(r,3990))},6055:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(70531),s=r(97247);let n=(0,a.Z)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},68923:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(70531),s=r(97247);let n=(0,a.Z)((0,s.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail")},3990:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>G});var a=r(97247),s=r(28964),n=r(34178),i=r(70380),o=r(24222),l=r(94742),d=r(81090),c=r(42658),u=r(20331),x=r(84661),g=r(53187),p=r(78708),h=r(82891),m=r(52833),b=r(71804),f=r(11611),j=r(13142),Z=r(24091),v=r(74247),y=r(19065),k=r(77528),w=r(66122),C=r(73275),P=r(68923),S=r(70531);let q=(0,S.Z)((0,a.jsx)("path",{d:"M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2m0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19z"}),"Inbox"),W=(0,S.Z)((0,a.jsx)("path",{d:"M19 3H4.99c-1.11 0-1.98.9-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19zM8 11h2v3h4v-3h2l-4-4z"}),"Outbox");var M=r(7013),I=r(2941),R=r(76058),_=r(6055),z=r(41755),D=r(9190),H=r(88111),L=r(64560),E=r(19898),F=r(67325),A=r(37688),$=r(35588),B=r(72497);let G=()=>{let e=(0,i.Z)(),{showMessage:t}=(0,L.U)(),{data:r,status:S}=(0,E.useSession)(),G=(0,z.NL)(),K=(0,n.useSearchParams)(),U=(0,n.useRouter)();(0,s.useEffect)(()=>{"unauthenticated"===S&&U.push("/channels")},[S,U]);let[V,Q]=(0,s.useState)(0),[T,O]=(0,s.useState)(""),[N,X]=(0,s.useState)(""),[J,Y]=(0,s.useState)("");(0,s.useEffect)(()=>{if(K){let e=K.get("to");e&&(Q(2),O(e),t(`${e}님에게 쪽지를 보낼 수 있습니다.`,"info"))}},[K,t]);let[ee,et]=(0,s.useState)(null),[er,ea]=(0,s.useState)(!1),[es,en]=(0,s.useState)(!1),[ei,eo]=(0,s.useState)(""),[el,ed]=(0,s.useState)(""),[ec,eu]=(0,s.useState)(T);(0,s.useEffect)(()=>{eu(T)},[T]);let{data:ex,isLoading:eg,error:ep}=(0,D.a)({queryKey:["receivedMessages"],queryFn:()=>(0,$.bX)(1,20),enabled:!!r?.user}),{data:eh,isLoading:em,error:eb}=(0,D.a)({queryKey:["sentMessages"],queryFn:()=>(0,$.O4)(1,20),enabled:!!r?.user}),ef=(0,H.D)({mutationFn:e=>(0,$.bG)(e),onSuccess:()=>{t("쪽지가 성공적으로 전송되었습니다!","success"),eu(""),O(""),X(""),Y(""),G.invalidateQueries({queryKey:["sentMessages"]})},onError:e=>{t(e.response?.data?.message||"쪽지 전송에 실패했습니다.","error")}}),ej=(0,H.D)({mutationFn:e=>(0,$.RC)(e),onSuccess:()=>{G.invalidateQueries({queryKey:["receivedMessages"]})}}),eZ=(0,H.D)({mutationFn:e=>(0,$.$Z)(e),onSuccess:()=>{t("쪽지가 삭제되었습니다.","success"),ea(!1),et(null),G.invalidateQueries({queryKey:["receivedMessages"]}),G.invalidateQueries({queryKey:["sentMessages"]})},onError:()=>{t("쪽지 삭제에 실패했습니다.","error")}}),ev=(0,H.D)({mutationFn:({messageId:e,data:t})=>(0,$.o6)(e,t),onSuccess:e=>{t("쪽지가 수정되었습니다.","success"),en(!1),eo(""),ed(""),ee&&et({...ee,title:ei,content:el}),G.invalidateQueries({queryKey:["sentMessages"]})},onError:e=>{t(e.response?.data?.message||"쪽지 수정에 실패했습니다.","error")}}),ey=e=>{et(e),ea(!0),en(!1),eo(""),ed(""),e.isRead||0!==V||ej.mutate(e.id)},ek=e=>(0,F.Q)(new Date(e),{addSuffix:!0,locale:A.ko});return"loading"===S?a.jsx(B.default,{}):r?.user?(0,a.jsxs)(o.Z,{sx:{minHeight:"100vh",background:"dark"===e.palette.mode?"linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(16, 16, 32, 0.98))":"linear-gradient(135deg, #f8f9fa, #e9ecef)",p:3},children:[a.jsx(l.Z,{sx:{maxWidth:1e3,mx:"auto",borderRadius:"16px",background:"dark"===e.palette.mode?"linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(45, 48, 71, 0.95) 100%)":"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",border:"dark"===e.palette.mode?"1px solid rgba(139, 92, 246, 0.2)":"1px solid rgba(0, 0, 0, 0.08)",boxShadow:"dark"===e.palette.mode?"0 8px 32px rgba(139, 92, 246, 0.15)":"0 8px 24px rgba(0, 0, 0, 0.08)"},children:(0,a.jsxs)(d.Z,{sx:{p:3},children:[(0,a.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[a.jsx(P.Z,{sx:{fontSize:32,color:"dark"===e.palette.mode?"#a78bfa":"#8b5cf6"}}),a.jsx(c.Z,{variant:"h4",sx:{fontWeight:700,background:"dark"===e.palette.mode?"linear-gradient(135deg, #a78bfa, #22d3ee)":"linear-gradient(135deg, #8b5cf6, #06b6d4)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"쪽지함"})]}),(0,a.jsxs)(u.Z,{value:V,onChange:(e,t)=>{Q(t),et(null),ea(!1),en(!1),eo(""),ed("")},sx:{mb:3,"& .MuiTabs-indicator":{background:"linear-gradient(90deg, #8b5cf6, #06b6d4)"}},children:[a.jsx(x.Z,{icon:a.jsx(q,{}),label:"받은 쪽지",sx:{fontWeight:600,color:"dark"===e.palette.mode?"#e2e8f0":"#374151"}}),a.jsx(x.Z,{icon:a.jsx(W,{}),label:"보낸 쪽지",sx:{fontWeight:600,color:"dark"===e.palette.mode?"#e2e8f0":"#374151"}}),a.jsx(x.Z,{icon:a.jsx(M.Z,{}),label:"새 쪽지",sx:{fontWeight:600,color:"dark"===e.palette.mode?"#e2e8f0":"#374151"}})]}),0===V&&(0,a.jsxs)(o.Z,{children:[a.jsx(c.Z,{variant:"h6",sx:{mb:2,fontWeight:600},children:"받은 쪽지"}),eg?a.jsx(o.Z,{sx:{display:"flex",justifyContent:"center",py:4},children:a.jsx(g.Z,{})}):ex?.messages.length===0?(0,a.jsxs)(o.Z,{sx:{textAlign:"center",py:4},children:[a.jsx(q,{sx:{fontSize:64,color:"dark"===e.palette.mode?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",mb:2}}),a.jsx(c.Z,{color:"text.secondary",children:"받은 쪽지가 없습니다."})]}):a.jsx(p.Z,{children:ex?.messages.map(t=>a.jsxs(h.ZP,{onClick:()=>ey(t),sx:{borderRadius:2,mb:1,backgroundColor:"dark"===e.palette.mode?t.isRead?"rgba(45, 48, 56, 0.6)":"rgba(139, 92, 246, 0.1)":t.isRead?"rgba(249, 250, 251, 0.8)":"rgba(139, 92, 246, 0.05)",cursor:"pointer","&:hover":{backgroundColor:"dark"===e.palette.mode?"rgba(139, 92, 246, 0.15)":"rgba(139, 92, 246, 0.1)"}},children:[a.jsx(m.Z,{children:a.jsx(b.Z,{src:`http://localhost:9999${t.sender.profileImage}`,sx:{width:40,height:40,background:t.sender.profileImage?"transparent":"linear-gradient(135deg, #8b5cf6, #06b6d4)"},children:!t.sender.profileImage&&a.jsx(I.Z,{})})}),a.jsx(f.Z,{primary:a.jsxs(o.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(c.Z,{variant:"subtitle1",sx:{fontWeight:t.isRead?400:700},children:t.title}),!t.isRead&&a.jsx(j.Z,{label:"NEW",size:"small",sx:{height:20,fontSize:"0.7rem",fontWeight:"bold",background:"linear-gradient(135deg, #ff6b6b, #ff8e53)",color:"white"}})]}),secondary:a.jsxs(o.Z,{component:"div",children:[a.jsxs(c.Z,{variant:"body2",color:"text.secondary",component:"div",children:["보낸이: ",t.sender.nickname]}),a.jsx(c.Z,{variant:"caption",color:"text.secondary",component:"div",children:ek(t.createdAt)})]}),secondaryTypographyProps:{component:"div"}})]},t.id))})]}),1===V&&(0,a.jsxs)(o.Z,{children:[a.jsx(c.Z,{variant:"h6",sx:{mb:2,fontWeight:600},children:"보낸 쪽지"}),em?a.jsx(o.Z,{sx:{display:"flex",justifyContent:"center",py:4},children:a.jsx(g.Z,{})}):eh?.messages.length===0?(0,a.jsxs)(o.Z,{sx:{textAlign:"center",py:4},children:[a.jsx(W,{sx:{fontSize:64,color:"dark"===e.palette.mode?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",mb:2}}),a.jsx(c.Z,{color:"text.secondary",children:"보낸 쪽지가 없습니다."})]}):a.jsx(p.Z,{children:eh?.messages.map(t=>a.jsxs(h.ZP,{onClick:()=>ey(t),sx:{borderRadius:2,mb:1,backgroundColor:"dark"===e.palette.mode?"rgba(45, 48, 56, 0.6)":"rgba(249, 250, 251, 0.8)",cursor:"pointer","&:hover":{backgroundColor:"dark"===e.palette.mode?"rgba(139, 92, 246, 0.15)":"rgba(139, 92, 246, 0.1)"}},children:[a.jsx(m.Z,{children:a.jsx(b.Z,{src:`http://localhost:9999${t.receiver.profileImage}`,sx:{width:40,height:40,background:t.receiver.profileImage?"transparent":"linear-gradient(135deg, #06b6d4, #8b5cf6)"},children:!t.receiver.profileImage&&a.jsx(I.Z,{})})}),a.jsx(f.Z,{primary:a.jsx(c.Z,{variant:"subtitle1",sx:{fontWeight:500},children:t.title}),secondary:a.jsxs(o.Z,{component:"div",children:[a.jsxs(c.Z,{variant:"body2",color:"text.secondary",component:"div",children:["받는이: ",t.receiver.nickname]}),a.jsx(c.Z,{variant:"caption",color:"text.secondary",component:"div",children:ek(t.createdAt)})]}),secondaryTypographyProps:{component:"div"}})]},t.id))})]}),2===V&&(0,a.jsxs)(o.Z,{children:[a.jsx(c.Z,{variant:"h6",sx:{mb:3,fontWeight:600},children:"새 쪽지 작성"}),(0,a.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:[a.jsx(Z.Z,{label:"받는 사람",value:ec,onChange:e=>eu(e.target.value),fullWidth:!0,variant:"outlined",size:"small"}),a.jsx(Z.Z,{label:"제목",value:N,onChange:e=>X(e.target.value),fullWidth:!0,variant:"outlined"}),a.jsx(Z.Z,{label:"내용",value:J,onChange:e=>Y(e.target.value),fullWidth:!0,multiline:!0,rows:8,variant:"outlined"}),a.jsx(v.Z,{variant:"contained",startIcon:a.jsx(R.Z,{}),onClick:()=>{if(!ec.trim()){t("받는 사람의 닉네임을 입력해주세요.","warning");return}if(!N.trim()){t("제목을 입력해주세요.","warning");return}if(!J.trim()){t("내용을 입력해주세요.","warning");return}ef.mutate({receiverNickname:ec.trim(),title:N.trim(),content:J.trim()})},disabled:ef.isPending,sx:{alignSelf:"flex-end",px:4,py:1.5,borderRadius:"12px",background:"linear-gradient(135deg, #8b5cf6, #06b6d4)",fontWeight:600,"&:hover":{background:"linear-gradient(135deg, #7c3aed, #0891b2)"}},children:ef.isPending?a.jsx(g.Z,{size:20}):"쪽지 보내기"})]})]})]})}),a.jsx(y.Z,{open:er,onClose:()=>ea(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",background:"dark"===e.palette.mode?"rgba(30, 32, 38, 0.98)":"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(12px)"}},children:ee&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(k.Z,{sx:{fontWeight:700,color:"dark"===e.palette.mode?"#ffffff":"#1a1a2e",borderBottom:`1px solid ${"dark"===e.palette.mode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}`},children:(0,a.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[a.jsx(I.Z,{}),ee.title]})}),(0,a.jsxs)(w.Z,{sx:{py:2},children:[(0,a.jsxs)(o.Z,{sx:{mb:2,mt:2},children:[(0,a.jsxs)(c.Z,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[0===V?"보낸이":"받는이",":"," ",0===V?ee.sender?.nickname||"알 수 없음":ee.receiver?.nickname||"알 수 없음"]}),a.jsx(c.Z,{variant:"body2",color:"text.secondary",children:ek(ee.createdAt)})]}),es?(0,a.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[a.jsx(Z.Z,{label:"제목",value:ei,onChange:e=>eo(e.target.value),fullWidth:!0,variant:"outlined"}),a.jsx(Z.Z,{label:"내용",value:el,onChange:e=>ed(e.target.value),fullWidth:!0,multiline:!0,rows:6,variant:"outlined"})]}):(0,a.jsxs)(o.Z,{children:[a.jsx(c.Z,{variant:"h6",sx:{mb:2,fontWeight:600},children:ee.title}),a.jsx(c.Z,{variant:"body1",sx:{lineHeight:1.8,whiteSpace:"pre-wrap",color:"dark"===e.palette.mode?"#e2e8f0":"#374151"},children:ee.content})]})]}),(0,a.jsxs)(C.Z,{sx:{p:3,gap:1},children:[a.jsx(v.Z,{onClick:()=>ea(!1),variant:"outlined",children:"닫기"}),es?(0,a.jsxs)(a.Fragment,{children:[a.jsx(v.Z,{onClick:()=>{en(!1),eo(""),ed("")},variant:"outlined",color:"secondary",children:"취소"}),a.jsx(v.Z,{onClick:()=>{if(ee){if(!ei.trim()){t("제목을 입력해주세요.","warning");return}if(!el.trim()){t("내용을 입력해주세요.","warning");return}ev.mutate({messageId:ee.id,data:{title:ei.trim(),content:el.trim()}})}},variant:"contained",startIcon:a.jsx(M.Z,{}),disabled:ev.isPending,children:"저장"})]}):(0,a.jsxs)(a.Fragment,{children:[1===V&&!ee.isRead&&a.jsx(v.Z,{onClick:()=>{ee&&(en(!0),eo(ee.title),ed(ee.content))},variant:"contained",startIcon:a.jsx(M.Z,{}),children:"수정"}),a.jsx(v.Z,{onClick:()=>{ee&&eZ.mutate(ee.id)},variant:"contained",color:"error",startIcon:a.jsx(_.Z,{}),disabled:eZ.isPending,children:"삭제"})]})]})]})})]}):null}},35588:(e,t,r)=>{"use strict";r.d(t,{$Z:()=>d,O4:()=>n,RC:()=>o,bG:()=>i,bX:()=>s,o6:()=>l});var a=r(10863);let s=async(e=1,t=10)=>{try{return(await a.Z.get("http://localhost:9999/api/messages/received",{params:{page:e,limit:t},withCredentials:!0})).data}catch(e){return console.error("받은 쪽지 목록 조회 실패:",e),{messages:[],total:0,page:1,limit:10}}},n=async(e=1,t=10)=>{try{return(await a.Z.get("http://localhost:9999/api/messages/sent",{params:{page:e,limit:t},withCredentials:!0})).data}catch(e){return console.error("보낸 쪽지 목록 조회 실패:",e),{messages:[],total:0,page:1,limit:10}}},i=async e=>{try{return(await a.Z.post("http://localhost:9999/api/messages/send",e,{withCredentials:!0})).data}catch(e){throw console.error("쪽지 보내기 실패:",e),e}},o=async e=>(await a.Z.patch(`http://localhost:9999/api/messages/${e}/read`,{},{withCredentials:!0})).data,l=async(e,t)=>{try{return(await a.Z.patch(`http://localhost:9999/api/messages/${e}`,t,{withCredentials:!0})).data}catch(e){throw console.error("쪽지 수정 실패:",e),e}},d=async e=>(await a.Z.delete(`http://localhost:9999/api/messages/${e}`,{withCredentials:!0})).data},72958:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(45347).createProxy)(String.raw`C:\Users\wngus\Documents\Study-Board\front\src\app\(afterLogin)\messages\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[379,819,638,33],()=>r(81801));module.exports=a})();