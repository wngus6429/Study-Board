(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2664],{74239:function(e,t,a){Promise.resolve().then(a.bind(a,8412))},8412:function(e,t,a){"use strict";a.r(t);var r=a(57437),n=a(2265),s=a(99376),i=a(31691),o=a(2069),l=a(67208),d=a(36137),c=a(46387),g=a(64461),u=a(28450),x=a(35389),h=a(15273),p=a(87055),m=a(53431),f=a(67116),b=a(67051),v=a(67571),j=a(97404),Z=a(91991),y=a(53392),k=a(79507),C=a(77468),w=a(9026),S=a(92495),W=a(18953),I=a(75223),R=a(54862),F=a(72549),P=a(88164),z=a(76672),E=a(29827),M=a(16593),q=a(21770),D=a(30419),K=a(80605),T=a(39795),A=a(56410),N=a(75304),Q=a(94623);t.default=()=>{var e,t;let a=(0,i.Z)(),{showMessage:_}=(0,D.U)(),{data:O,status:B}=(0,K.useSession)(),L=(0,E.NL)(),U=(0,s.useSearchParams)(),G=(0,s.useRouter)();(0,n.useEffect)(()=>{"unauthenticated"===B&&G.push("/channels")},[B,G]);let[H,X]=(0,n.useState)(0),[$,J]=(0,n.useState)(""),[V,Y]=(0,n.useState)(""),[ee,et]=(0,n.useState)("");(0,n.useEffect)(()=>{if(U){let e=U.get("to");e&&(X(2),J(e),_("".concat(e,"님에게 쪽지를 보낼 수 있습니다."),"info"))}},[U,_]);let[ea,er]=(0,n.useState)(null),[en,es]=(0,n.useState)(!1),[ei,eo]=(0,n.useState)(!1),[el,ed]=(0,n.useState)(""),[ec,eg]=(0,n.useState)(""),[eu,ex]=(0,n.useState)($);(0,n.useEffect)(()=>{ex($)},[$]);let{data:eh,isLoading:ep,error:em}=(0,M.a)({queryKey:["receivedMessages"],queryFn:()=>(0,N.bX)(1,20),enabled:!!(null==O?void 0:O.user)}),{data:ef,isLoading:eb,error:ev}=(0,M.a)({queryKey:["sentMessages"],queryFn:()=>(0,N.O4)(1,20),enabled:!!(null==O?void 0:O.user)}),ej=(0,q.D)({mutationFn:e=>(0,N.bG)(e),onSuccess:()=>{_("쪽지가 성공적으로 전송되었습니다!","success"),ex(""),J(""),Y(""),et(""),L.invalidateQueries({queryKey:["sentMessages"]})},onError:e=>{var t,a;_((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"쪽지 전송에 실패했습니다.","error")}}),eZ=(0,q.D)({mutationFn:e=>(0,N.RC)(e),onSuccess:()=>{L.invalidateQueries({queryKey:["receivedMessages"]})}}),ey=(0,q.D)({mutationFn:e=>(0,N.$Z)(e),onSuccess:()=>{_("쪽지가 삭제되었습니다.","success"),es(!1),er(null),L.invalidateQueries({queryKey:["receivedMessages"]}),L.invalidateQueries({queryKey:["sentMessages"]})},onError:()=>{_("쪽지 삭제에 실패했습니다.","error")}}),ek=(0,q.D)({mutationFn:e=>{let{messageId:t,data:a}=e;return(0,N.o6)(t,a)},onSuccess:e=>{_("쪽지가 수정되었습니다.","success"),eo(!1),ed(""),eg(""),ea&&er({...ea,title:el,content:ec}),L.invalidateQueries({queryKey:["sentMessages"]})},onError:e=>{var t,a;_((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"쪽지 수정에 실패했습니다.","error")}}),eC=e=>{er(e),es(!0),eo(!1),ed(""),eg(""),e.isRead||0!==H||eZ.mutate(e.id)},ew=e=>(0,T.Q)(new Date(e),{addSuffix:!0,locale:A.ko});return"loading"===B?(0,r.jsx)(Q.default,{}):(null==O?void 0:O.user)?(0,r.jsxs)(o.Z,{sx:{minHeight:"100vh",background:"dark"===a.palette.mode?"linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(16, 16, 32, 0.98))":"linear-gradient(135deg, #f8f9fa, #e9ecef)",p:3},children:[(0,r.jsx)(l.Z,{sx:{maxWidth:1e3,mx:"auto",borderRadius:"16px",background:"dark"===a.palette.mode?"linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(45, 48, 71, 0.95) 100%)":"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",border:"dark"===a.palette.mode?"1px solid rgba(139, 92, 246, 0.2)":"1px solid rgba(0, 0, 0, 0.08)",boxShadow:"dark"===a.palette.mode?"0 8px 32px rgba(139, 92, 246, 0.15)":"0 8px 24px rgba(0, 0, 0, 0.08)"},children:(0,r.jsxs)(d.Z,{sx:{p:3},children:[(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[(0,r.jsx)(S.Z,{sx:{fontSize:32,color:"dark"===a.palette.mode?"#a78bfa":"#8b5cf6"}}),(0,r.jsx)(c.Z,{variant:"h4",sx:{fontWeight:700,background:"dark"===a.palette.mode?"linear-gradient(135deg, #a78bfa, #22d3ee)":"linear-gradient(135deg, #8b5cf6, #06b6d4)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"쪽지함"})]}),(0,r.jsxs)(g.Z,{value:H,onChange:(e,t)=>{X(t),er(null),es(!1),eo(!1),ed(""),eg("")},sx:{mb:3,"& .MuiTabs-indicator":{background:"linear-gradient(90deg, #8b5cf6, #06b6d4)"}},children:[(0,r.jsx)(u.Z,{icon:(0,r.jsx)(W.Z,{}),label:"받은 쪽지",sx:{fontWeight:600,color:"dark"===a.palette.mode?"#e2e8f0":"#374151"}}),(0,r.jsx)(u.Z,{icon:(0,r.jsx)(I.Z,{}),label:"보낸 쪽지",sx:{fontWeight:600,color:"dark"===a.palette.mode?"#e2e8f0":"#374151"}}),(0,r.jsx)(u.Z,{icon:(0,r.jsx)(R.Z,{}),label:"새 쪽지",sx:{fontWeight:600,color:"dark"===a.palette.mode?"#e2e8f0":"#374151"}})]}),0===H&&(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(c.Z,{variant:"h6",sx:{mb:2,fontWeight:600},children:"받은 쪽지"}),ep?(0,r.jsx)(o.Z,{sx:{display:"flex",justifyContent:"center",py:4},children:(0,r.jsx)(x.Z,{})}):(null==eh?void 0:eh.messages.length)===0?(0,r.jsxs)(o.Z,{sx:{textAlign:"center",py:4},children:[(0,r.jsx)(W.Z,{sx:{fontSize:64,color:"dark"===a.palette.mode?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",mb:2}}),(0,r.jsx)(c.Z,{color:"text.secondary",children:"받은 쪽지가 없습니다."})]}):(0,r.jsx)(h.Z,{children:null==eh?void 0:eh.messages.map(e=>(0,r.jsxs)(p.ZP,{onClick:()=>eC(e),sx:{borderRadius:2,mb:1,backgroundColor:"dark"===a.palette.mode?e.isRead?"rgba(45, 48, 56, 0.6)":"rgba(139, 92, 246, 0.1)":e.isRead?"rgba(249, 250, 251, 0.8)":"rgba(139, 92, 246, 0.05)",cursor:"pointer","&:hover":{backgroundColor:"dark"===a.palette.mode?"rgba(139, 92, 246, 0.15)":"rgba(139, 92, 246, 0.1)"}},children:[(0,r.jsx)(m.Z,{children:(0,r.jsx)(f.Z,{src:"".concat("http://localhost:9999").concat(e.sender.profileImage),sx:{width:40,height:40,background:e.sender.profileImage?"transparent":"linear-gradient(135deg, #8b5cf6, #06b6d4)"},children:!e.sender.profileImage&&(0,r.jsx)(F.Z,{})})}),(0,r.jsx)(b.Z,{primary:(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:e.isRead?400:700},children:e.title}),!e.isRead&&(0,r.jsx)(v.Z,{label:"NEW",size:"small",sx:{height:20,fontSize:"0.7rem",fontWeight:"bold",background:"linear-gradient(135deg, #ff6b6b, #ff8e53)",color:"white"}})]}),secondary:(0,r.jsxs)(o.Z,{component:"div",children:[(0,r.jsxs)(c.Z,{variant:"body2",color:"text.secondary",component:"div",children:["보낸이: ",e.sender.nickname]}),(0,r.jsx)(c.Z,{variant:"caption",color:"text.secondary",component:"div",children:ew(e.createdAt)})]}),secondaryTypographyProps:{component:"div"}})]},e.id))})]}),1===H&&(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(c.Z,{variant:"h6",sx:{mb:2,fontWeight:600},children:"보낸 쪽지"}),eb?(0,r.jsx)(o.Z,{sx:{display:"flex",justifyContent:"center",py:4},children:(0,r.jsx)(x.Z,{})}):(null==ef?void 0:ef.messages.length)===0?(0,r.jsxs)(o.Z,{sx:{textAlign:"center",py:4},children:[(0,r.jsx)(I.Z,{sx:{fontSize:64,color:"dark"===a.palette.mode?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",mb:2}}),(0,r.jsx)(c.Z,{color:"text.secondary",children:"보낸 쪽지가 없습니다."})]}):(0,r.jsx)(h.Z,{children:null==ef?void 0:ef.messages.map(e=>(0,r.jsxs)(p.ZP,{onClick:()=>eC(e),sx:{borderRadius:2,mb:1,backgroundColor:"dark"===a.palette.mode?"rgba(45, 48, 56, 0.6)":"rgba(249, 250, 251, 0.8)",cursor:"pointer","&:hover":{backgroundColor:"dark"===a.palette.mode?"rgba(139, 92, 246, 0.15)":"rgba(139, 92, 246, 0.1)"}},children:[(0,r.jsx)(m.Z,{children:(0,r.jsx)(f.Z,{src:"".concat("http://localhost:9999").concat(e.receiver.profileImage),sx:{width:40,height:40,background:e.receiver.profileImage?"transparent":"linear-gradient(135deg, #06b6d4, #8b5cf6)"},children:!e.receiver.profileImage&&(0,r.jsx)(F.Z,{})})}),(0,r.jsx)(b.Z,{primary:(0,r.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:500},children:e.title}),secondary:(0,r.jsxs)(o.Z,{component:"div",children:[(0,r.jsxs)(c.Z,{variant:"body2",color:"text.secondary",component:"div",children:["받는이: ",e.receiver.nickname]}),(0,r.jsx)(c.Z,{variant:"caption",color:"text.secondary",component:"div",children:ew(e.createdAt)})]}),secondaryTypographyProps:{component:"div"}})]},e.id))})]}),2===H&&(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(c.Z,{variant:"h6",sx:{mb:3,fontWeight:600},children:"새 쪽지 작성"}),(0,r.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,r.jsx)(j.Z,{label:"받는 사람",value:eu,onChange:e=>ex(e.target.value),fullWidth:!0,variant:"outlined",size:"small"}),(0,r.jsx)(j.Z,{label:"제목",value:V,onChange:e=>Y(e.target.value),fullWidth:!0,variant:"outlined"}),(0,r.jsx)(j.Z,{label:"내용",value:ee,onChange:e=>et(e.target.value),fullWidth:!0,multiline:!0,rows:8,variant:"outlined"}),(0,r.jsx)(Z.Z,{variant:"contained",startIcon:(0,r.jsx)(P.Z,{}),onClick:()=>{if(!eu.trim()){_("받는 사람의 닉네임을 입력해주세요.","warning");return}if(!V.trim()){_("제목을 입력해주세요.","warning");return}if(!ee.trim()){_("내용을 입력해주세요.","warning");return}ej.mutate({receiverNickname:eu.trim(),title:V.trim(),content:ee.trim()})},disabled:ej.isPending,sx:{alignSelf:"flex-end",px:4,py:1.5,borderRadius:"12px",background:"linear-gradient(135deg, #8b5cf6, #06b6d4)",fontWeight:600,"&:hover":{background:"linear-gradient(135deg, #7c3aed, #0891b2)"}},children:ej.isPending?(0,r.jsx)(x.Z,{size:20}):"쪽지 보내기"})]})]})]})}),(0,r.jsx)(y.Z,{open:en,onClose:()=>es(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",background:"dark"===a.palette.mode?"rgba(30, 32, 38, 0.98)":"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(12px)"}},children:ea&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.Z,{sx:{fontWeight:700,color:"dark"===a.palette.mode?"#ffffff":"#1a1a2e",borderBottom:"1px solid ".concat("dark"===a.palette.mode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)")},children:(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(F.Z,{}),ea.title]})}),(0,r.jsxs)(C.Z,{sx:{py:2},children:[(0,r.jsxs)(o.Z,{sx:{mb:2,mt:2},children:[(0,r.jsxs)(c.Z,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[0===H?"보낸이":"받는이",":"," ",0===H?(null===(e=ea.sender)||void 0===e?void 0:e.nickname)||"알 수 없음":(null===(t=ea.receiver)||void 0===t?void 0:t.nickname)||"알 수 없음"]}),(0,r.jsx)(c.Z,{variant:"body2",color:"text.secondary",children:ew(ea.createdAt)})]}),ei?(0,r.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,r.jsx)(j.Z,{label:"제목",value:el,onChange:e=>ed(e.target.value),fullWidth:!0,variant:"outlined"}),(0,r.jsx)(j.Z,{label:"내용",value:ec,onChange:e=>eg(e.target.value),fullWidth:!0,multiline:!0,rows:6,variant:"outlined"})]}):(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(c.Z,{variant:"h6",sx:{mb:2,fontWeight:600},children:ea.title}),(0,r.jsx)(c.Z,{variant:"body1",sx:{lineHeight:1.8,whiteSpace:"pre-wrap",color:"dark"===a.palette.mode?"#e2e8f0":"#374151"},children:ea.content})]})]}),(0,r.jsxs)(w.Z,{sx:{p:3,gap:1},children:[(0,r.jsx)(Z.Z,{onClick:()=>es(!1),variant:"outlined",children:"닫기"}),ei?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Z.Z,{onClick:()=>{eo(!1),ed(""),eg("")},variant:"outlined",color:"secondary",children:"취소"}),(0,r.jsx)(Z.Z,{onClick:()=>{if(ea){if(!el.trim()){_("제목을 입력해주세요.","warning");return}if(!ec.trim()){_("내용을 입력해주세요.","warning");return}ek.mutate({messageId:ea.id,data:{title:el.trim(),content:ec.trim()}})}},variant:"contained",startIcon:(0,r.jsx)(R.Z,{}),disabled:ek.isPending,children:"저장"})]}):(0,r.jsxs)(r.Fragment,{children:[1===H&&!ea.isRead&&(0,r.jsx)(Z.Z,{onClick:()=>{ea&&(eo(!0),ed(ea.title),eg(ea.content))},variant:"contained",startIcon:(0,r.jsx)(R.Z,{}),children:"수정"}),(0,r.jsx)(Z.Z,{onClick:()=>{ea&&ey.mutate(ea.id)},variant:"contained",color:"error",startIcon:(0,r.jsx)(z.Z,{}),disabled:ey.isPending,children:"삭제"})]})]})]})})]}):null}},75304:function(e,t,a){"use strict";a.d(t,{$Z:function(){return d},O4:function(){return s},RC:function(){return o},bG:function(){return i},bX:function(){return n},o6:function(){return l}});var r=a(83464);let n=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{return(await r.Z.get("".concat("http://localhost:9999","/api/messages/received"),{params:{page:e,limit:t},withCredentials:!0})).data}catch(e){return console.error("받은 쪽지 목록 조회 실패:",e),{messages:[],total:0,page:1,limit:10}}},s=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{return(await r.Z.get("".concat("http://localhost:9999","/api/messages/sent"),{params:{page:e,limit:t},withCredentials:!0})).data}catch(e){return console.error("보낸 쪽지 목록 조회 실패:",e),{messages:[],total:0,page:1,limit:10}}},i=async e=>{try{return(await r.Z.post("".concat("http://localhost:9999","/api/messages/send"),e,{withCredentials:!0})).data}catch(e){throw console.error("쪽지 보내기 실패:",e),e}},o=async e=>(await r.Z.patch("".concat("http://localhost:9999","/api/messages/").concat(e,"/read"),{},{withCredentials:!0})).data,l=async(e,t)=>{try{return(await r.Z.patch("".concat("http://localhost:9999","/api/messages/").concat(e),t,{withCredentials:!0})).data}catch(e){throw console.error("쪽지 수정 실패:",e),e}},d=async e=>(await r.Z.delete("".concat("http://localhost:9999","/api/messages/").concat(e),{withCredentials:!0})).data},94623:function(e,t,a){"use strict";a.d(t,{default:function(){return i}});var r=a(57437),n=a(35389),s=a(31691);function i(){let e=(0,s.Z)();return(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"dark"===e.palette.mode?"rgba(18, 18, 18, 0.3)":"rgba(255, 255, 255, 0.3)",backdropFilter:"blur(1px)",zIndex:9999,display:"flex",justifyContent:"center",alignItems:"center",transition:"background-color 0.3s ease"},children:(0,r.jsxs)("div",{style:{textAlign:"center",backgroundColor:"dark"===e.palette.mode?"#1e1e1e":"#ffffff",padding:"24px 32px",borderRadius:"12px",boxShadow:"dark"===e.palette.mode?"0 8px 24px rgba(0, 0, 0, 0.5)":"0 8px 24px rgba(0, 0, 0, 0.15)",border:"dark"===e.palette.mode?"1px solid #333333":"1px solid #e0e0e0"},children:[(0,r.jsx)(n.Z,{size:48,thickness:4,sx:{color:"dark"===e.palette.mode?"#bb86fc":"#1976d2",marginBottom:1}}),(0,r.jsx)("div",{style:{marginTop:"12px",fontSize:"14px",color:"dark"===e.palette.mode?"#e0e0e0":"#666666",fontWeight:500},children:"로딩 중..."})]})})}a(2265)},30419:function(e,t,a){"use strict";a.d(t,{U:function(){return r}});let r=(0,a(3011).U)(e=>({messageState:!1,messageContent:"",messageStyle:"success",messageTransition:"fade",showMessage:function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"fade";return e({messageState:!0,messageContent:t,messageStyle:a,messageTransition:r})},hideMessage:()=>e({messageState:!1,messageContent:""})}))}},function(e){e.O(0,[5152,4419,1991,1547,6593,455,2472,7404,9631,605,6931,1256,7571,8921,9795,8938,4565,2971,2117,1744],function(){return e(e.s=74239)}),_N_E=e.O()}]);