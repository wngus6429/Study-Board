## 레벨링/뱃지 가이드

### 개요

- 에펨코리아 스타일의 활동 기반 레벨/뱃지 시스템입니다.
- 글/댓글/추천 활동에 따라 경험치가 증가하고, 누적 경험치가 임계값을 넘으면 레벨이 상승합니다.
- 사이트 전역에서는 닉네임 오른쪽에 뱃지 아이콘만 노출되고, 내 프로필 화면에서는 레벨 텍스트/뱃지/다음 레벨 정보가 함께 노출됩니다.

---

## 레벨/경험치 규칙

### 경험치 규칙(기본값)

- 글 작성: +2
- 댓글 작성: +0.5
- 내가 쓴 글의 좋아요: +1
- 내가 쓴 글의 싫어요: -1

조정 위치:

- 프론트: `front/src/app/const/LEVEL.ts` 의 `EXPERIENCE_RULES`
- 백엔드: `back/src/constants/level.ts` 의 `EXPERIENCE_RULES`

서버/클라이언트가 동일한 규칙을 사용하도록 같이 수정하세요.

### 레벨 임계값(기본값)

- Lv1: 0
- Lv2: 100
- Lv3: 300
- Lv4: 600
- Lv5: 1000
- Lv6: 1500

조정 위치:

- 프론트: `front/src/app/const/LEVEL.ts` 의 `LEVELS`
- 백엔드: `back/src/constants/level.ts` 의 `LEVELS` (레벨 수치만 사용)

---

## 뱃지 자산 매핑

이미지 위치: `front/public/assets`

- Lv1: `bronze.png` → Bronze
- Lv2: `gold.png` → Gold
- Lv3: `platinum.png` → Platinum
- Lv4: `diamond.png` → Diamond
- Lv5+: `rank.png` → Rank/Rank+

매핑 위치:

- `front/src/app/const/LEVEL.ts` 의 `LEVELS.badgeImage` (예: `/assets/bronze.png`)

---

## 프론트엔드 구현

### 주요 파일

- 상수: `front/src/app/const/LEVEL.ts`
- 레벨 계산: `front/src/app/utils/level.ts` (경험치 → 레벨/진행도 계산)
- 뱃지 컴포넌트: `front/src/app/components/common/UserBadge.tsx`

### 사용법(UserBadge)

```tsx
<UserBadge
  totalExperience={number}     // 서버에서 주는 누적 경험치 (권장)
  size="small" | "medium"
  showText={boolean}           // true: 텍스트+뱃지, false: 아이콘만
/>
```

### 노출 규칙 적용된 화면

- 댓글 목록: `front/src/app/components/comment/components/CommentList.tsx`

  - 닉네임 오른쪽에 아이콘만 노출 (`showText={false}`)
  - 삭제된 댓글(닉네임 null)에는 뱃지 미표시

- 건의 상세: `front/src/app/(afterLogin)/channels/[slug]/detail/suggestion/[id]/page.tsx`

  - 아이콘만 노출 (`showText={false}`)

- 사용자 프로필: `front/src/app/(noLogin)/profile/[username]/page.tsx`
  - 텍스트+뱃지+다음 레벨 경험치 노출 (`showText` 사용)

### 레벨 계산 표시 항목

- 현재 레벨(Lv.N)
- 현재 경험치
- 현재 레벨 진행도(%)
- 다음 레벨 최소 경험치(있을 경우)

---

## 백엔드 구현

### 컬럼 추가(유저)

- 파일: `back/src/entities/User.entity.ts`
- 컬럼:
  - `experience_points: float` (default 0)
  - `level: int` (default 1)

예시(SQL)

```sql
ALTER TABLE user ADD COLUMN experience_points FLOAT DEFAULT 0;
ALTER TABLE user ADD COLUMN level INT DEFAULT 1;
```

TypeORM 마이그레이션을 사용하는 경우, 동일 정의를 마이그레이션으로 추가하세요.

### 상수/계산

- 파일: `back/src/constants/level.ts`
  - `EXPERIENCE_RULES`: 경험치 규칙
  - `LEVELS`: 레벨 임계값
  - `getLevelByExperience(exp: number)`: 경험치 → 레벨 계산

### 경험치 업데이트 지점

- 글 작성: `back/src/story/story.service.ts#create`

  - 작성자 `experience_points += writePost` → `level` 재계산

- 댓글 작성: `back/src/comment/comment.service.ts#createComment`

  - 작성자 `experience_points += writeComment` → `level` 재계산

- 추천/비추천: `back/src/story/story.service.ts#storyLikeUnLike`
  - `likeCountAdjustment`(±1/±2)을 기반으로 게시글 작성자 경험치 조정
  - `experience_points += likeCountAdjustment * likeOnMyPost` → `level` 재계산

### API 응답 확장

- `GET /api/auth/profile/:username` (`AuthService.anotherUserGet`)
  - `user.level`, `user.experience_points` 포함

---

## 표출 규칙(정책)

- 전역: 닉네임 오른쪽에 배지 아이콘만 (텍스트 미노출)
- 내 프로필: 레벨 텍스트(Lv.N 이름) + 배지 아이콘 + 다음 레벨 목표(현재/다음 최소치)
- 삭제된 댓글: 배지 미노출

---

## 커스터마이징 가이드

### 경험치/레벨 조정

1. 프론트 `front/src/app/const/LEVEL.ts` 수정
2. 백엔드 `back/src/constants/level.ts` 수정
3. 서버 재배포, 클라이언트 재빌드

### 뱃지 이미지 교체

1. `front/public/assets/`에 이미지 교체 또는 추가
2. `front/src/app/const/LEVEL.ts` 의 `LEVELS.badgeImage` 경로를 교체

### 배지 표출 위치 추가

1. 해당 컴포넌트에서 `<UserBadge totalExperience={...} showText={false}/>` 삽입
2. 경험치 값이 없다면 0 또는 적절한 값으로 대체

---

## 초기화/마이그레이션 팁

기존 유저의 초기 경험치를 활동 집계로 산출하고 싶다면 배치 스크립트를 작성해 아래 기준으로 업데이트하세요.

- 초기 경험치 = (총 글 수 × writePost) + (총 댓글 수 × writeComment) + (받은 좋아요 수 × likeOnMyPost) + (받은 싫어요 수 × dislikeOnMyPost)
- 이후 `user.level = getLevelByExperience(user.experience_points)` 로 일괄 재계산

---

## 테스트 체크리스트

- 글/댓글/추천 시 경험치와 레벨이 기대대로 변경되는가
- 삭제된 댓글에 배지가 노출되지 않는가
- 전역 화면에서 텍스트 없이 아이콘만 보이는가
- 내 프로필에서 텍스트/배지/다음 레벨 정보가 모두 보이는가
- 임계값/규칙 변경 시 클라이언트/서버 모두 동일하게 적용되었는가
