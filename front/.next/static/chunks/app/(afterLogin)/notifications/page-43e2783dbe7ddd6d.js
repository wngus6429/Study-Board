(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8129],{8113:function(t,e,n){Promise.resolve().then(n.bind(n,1931))},76672:function(t,e,n){"use strict";var i=n(94630),r=n(57437);e.Z=(0,i.Z)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},19978:function(t,e,n){"use strict";n.d(e,{Z:function(){return y}});var i=n(2265),r=n(61994),a=n(50738),o=n(20801),s=n(53004),c=n(26269),u=n(9084),l=n(88662),d=n(57437);let p=(0,l.Z)(),f=(0,u.Z)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{let{ownerState:n}=t;return[e.root,e[`maxWidth${(0,s.Z)(String(n.maxWidth))}`],n.fixed&&e.fixed,n.disableGutters&&e.disableGutters]}}),h=t=>(0,c.Z)({props:t,name:"MuiContainer",defaultTheme:p}),m=(t,e)=>{let{classes:n,fixed:i,disableGutters:r,maxWidth:c}=t,u={root:["root",c&&`maxWidth${(0,s.Z)(String(c))}`,i&&"fixed",r&&"disableGutters"]};return(0,o.Z)(u,t=>(0,a.ZP)(e,t),n)};var x=n(85657),Z=n(16210),v=n(37053),y=function(t={}){let{createStyledComponent:e=f,useThemeProps:n=h,componentName:a="MuiContainer"}=t,o=e(({theme:t,ownerState:e})=>({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!e.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}}}),({theme:t,ownerState:e})=>e.fixed&&Object.keys(t.breakpoints.values).reduce((e,n)=>{let i=t.breakpoints.values[n];return 0!==i&&(e[t.breakpoints.up(n)]={maxWidth:`${i}${t.breakpoints.unit}`}),e},{}),({theme:t,ownerState:e})=>({..."xs"===e.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},...e.maxWidth&&"xs"!==e.maxWidth&&{[t.breakpoints.up(e.maxWidth)]:{maxWidth:`${t.breakpoints.values[e.maxWidth]}${t.breakpoints.unit}`}}}));return i.forwardRef(function(t,e){let i=n(t),{className:s,component:c="div",disableGutters:u=!1,fixed:l=!1,maxWidth:p="lg",classes:f,...h}=i,x={...i,component:c,disableGutters:u,fixed:l,maxWidth:p},Z=m(x,a);return(0,d.jsx)(o,{as:c,ownerState:x,className:(0,r.Z)(Z.root,s),ref:e,...h})})}({createStyledComponent:(0,Z.ZP)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{let{ownerState:n}=t;return[e.root,e["maxWidth".concat((0,x.Z)(String(n.maxWidth)))],n.fixed&&e.fixed,n.disableGutters&&e.disableGutters]}}),useThemeProps:t=>(0,v.i)({props:t,name:"MuiContainer"})})},15273:function(t,e,n){"use strict";n.d(e,{Z:function(){return m}});var i=n(2265),r=n(61994),a=n(20801),o=n(16210),s=n(37053),c=n(15566),u=n(94143),l=n(50738);function d(t){return(0,l.ZP)("MuiList",t)}(0,u.Z)("MuiList",["root","padding","dense","subheader"]);var p=n(57437);let f=t=>{let{classes:e,disablePadding:n,dense:i,subheader:r}=t;return(0,a.Z)({root:["root",!n&&"padding",i&&"dense",r&&"subheader"]},d,e)},h=(0,o.ZP)("ul",{name:"MuiList",slot:"Root",overridesResolver:(t,e)=>{let{ownerState:n}=t;return[e.root,!n.disablePadding&&e.padding,n.dense&&e.dense,n.subheader&&e.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:t=>{let{ownerState:e}=t;return!e.disablePadding},style:{paddingTop:8,paddingBottom:8}},{props:t=>{let{ownerState:e}=t;return e.subheader},style:{paddingTop:0}}]});var m=i.forwardRef(function(t,e){let n=(0,s.i)({props:t,name:"MuiList"}),{children:a,className:o,component:u="ul",dense:l=!1,disablePadding:d=!1,subheader:m,...x}=n,Z=i.useMemo(()=>({dense:l}),[l]),v={...n,component:u,dense:l,disablePadding:d},y=f(v);return(0,p.jsx)(c.Z.Provider,{value:Z,children:(0,p.jsxs)(h,{as:u,className:(0,r.Z)(y.root,o),ref:e,ownerState:v,...x,children:[m,a]})})})},15566:function(t,e,n){"use strict";let i=n(2265).createContext({});e.Z=i},80022:function(t,e){"use strict";e.Z=function(t){return"string"==typeof t}},18315:function(t,e,n){"use strict";var i=n(94378);e.Z=i.Z},77126:function(t,e,n){"use strict";n.d(e,{V:function(){return o}});var i=n(2265),r=n(57437);let a=i.createContext(),o=()=>i.useContext(a)??!1;e.Z=function({value:t,...e}){return(0,r.jsx)(a.Provider,{value:t??!0,...e})}},9084:function(t,e,n){"use strict";let i=(0,n(20825).ZP)();e.Z=i},26269:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var i=n(53232),r=n(20135);function a(t){let{props:e,name:n,defaultTheme:a,themeId:o}=t,s=(0,r.Z)(a);return o&&(s=s[o]||s),function(t){let{theme:e,name:n,props:r}=t;return e&&e.components&&e.components[n]&&e.components[n].defaultProps?(0,i.Z)(e.components[n].defaultProps,r):r}({theme:s,name:n,props:e})}},94378:function(t,e,n){"use strict";n.d(e,{Z:function(){return r}});var i=n(2265);function r(t,e){return i.isValidElement(t)&&-1!==e.indexOf(t.type.muiName??t.type?._payload?.value?.muiName)}},38462:function(t,e,n){"use strict";n.d(e,{Z:function(){return r}});var i=n(2265);function r(t){let{controlled:e,default:n,name:r,state:a="value"}=t,{current:o}=i.useRef(void 0!==e),[s,c]=i.useState(n),u=i.useCallback(t=>{o||c(t)},[]);return[o?e:s,u]}},1931:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return W}});var i=n(57437),r=n(2265),a=n(2069),o=n(35389),s=n(19978),c=n(46387),u=n(53410),l=n(91991),d=n(8350),p=n(15273),f=n(87055),h=n(59832),m=n(67051),x=n(67571),Z=n(36476),v=n(76672),y=n(29827),g=n(16593),b=n(21770),j=n(99376),C=n(80605),w=n(83076),k=n(39795),P=n(56410),R=n(11471);function W(){let t=(0,j.useRouter)(),{data:e,status:n}=(0,C.useSession)(),W=(0,y.NL)(),[N,S]=(0,r.useState)(1),{data:M,isLoading:q,error:L}=(0,g.a)({queryKey:["allNotifications",N],queryFn:()=>(0,w.kW)(N,R.VI),enabled:!!(null==e?void 0:e.user)&&"authenticated"===n}),_=(0,b.D)({mutationFn:w.Ix,onSuccess:()=>{W.invalidateQueries({queryKey:["allNotifications"]}),W.invalidateQueries({queryKey:["unreadNotifications"]})}}),I=(0,b.D)({mutationFn:w.Go,onSuccess:()=>{W.invalidateQueries({queryKey:["allNotifications"]}),W.invalidateQueries({queryKey:["unreadNotifications"]})}}),F=(0,b.D)({mutationFn:w.no,onSuccess:()=>{W.invalidateQueries({queryKey:["allNotifications"]}),W.invalidateQueries({queryKey:["unreadNotifications"]})}});if("loading"===n)return(0,i.jsx)(a.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:(0,i.jsx)(o.Z,{})});if(!(null==e?void 0:e.user))return t.push("/login"),null;let G=async e=>{var n;if(e.isRead||await _.mutateAsync(e.id),null===(n=e.comment)||void 0===n?void 0:n.storyId){let n="/detail/story/".concat(e.comment.storyId,"#comment-").concat(e.comment.id);t.push(n)}},Q=t=>(0,k.Q)(new Date(t),{addSuffix:!0,locale:P.ko}),K=t=>{var e,n;let i=(null===(e=t.comment)||void 0===e?void 0:e.author.nickname)||"알 수 없는 사용자",r=(null===(n=t.comment)||void 0===n?void 0:n.content)||"",a=r.length>100?r.substring(0,100)+"...":r;return"comment"===t.type?{title:"".concat(i,"님이 회원님의 글에 댓글을 남겼습니다"),content:a}:{title:"".concat(i,"님이 회원님의 댓글에 답글을 남겼습니다"),content:a}};return L?(0,i.jsx)(s.Z,{maxWidth:"md",sx:{mt:4},children:(0,i.jsx)(c.Z,{color:"error",children:"알림을 불러오는 중 오류가 발생했습니다."})}):(0,i.jsx)(s.Z,{maxWidth:"md",sx:{mt:4,mb:4},children:(0,i.jsxs)(u.Z,{sx:{p:3},children:[(0,i.jsxs)(a.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,i.jsx)(c.Z,{variant:"h4",fontWeight:"bold",children:"알림"}),M&&M.items.some(t=>!t.isRead)&&(0,i.jsx)(l.Z,{variant:"outlined",onClick:()=>I.mutate(),disabled:I.isPending,children:"모두 읽음으로 표시"})]}),(0,i.jsx)(d.Z,{sx:{mb:2}}),q?(0,i.jsx)(a.Z,{display:"flex",justifyContent:"center",py:5,children:(0,i.jsx)(o.Z,{})}):M&&0!==M.items.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.Z,{children:M.items.map((t,e)=>{let{title:n,content:o}=K(t);return(0,i.jsxs)(r.Fragment,{children:[(0,i.jsx)(f.ZP,{sx:{cursor:"pointer",backgroundColor:t.isRead?"transparent":"action.hover","&:hover":{backgroundColor:"action.selected"},borderRadius:1,mb:1},onClick:()=>G(t),secondaryAction:(0,i.jsx)(h.Z,{edge:"end","aria-label":"delete",onClick:e=>{e.stopPropagation(),F.mutate(t.id)},children:(0,i.jsx)(v.Z,{})}),children:(0,i.jsx)(m.Z,{primary:(0,i.jsxs)(a.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,i.jsx)(c.Z,{variant:"body1",fontWeight:t.isRead?"normal":"bold",children:n}),!t.isRead&&(0,i.jsx)(x.Z,{label:"새 알림",size:"small",color:"primary"})]}),secondary:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.Z,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o}),(0,i.jsx)(c.Z,{variant:"caption",color:"text.secondary",children:Q(t.createdAt)})]})})}),e<M.items.length-1&&(0,i.jsx)(d.Z,{})]},t.id)})}),M.totalPages>1&&(0,i.jsx)(a.Z,{display:"flex",justifyContent:"center",mt:3,children:(0,i.jsx)(Z.Z,{count:M.totalPages,page:N,onChange:(t,e)=>{S(e)},color:"primary"})})]}):(0,i.jsx)(a.Z,{py:5,textAlign:"center",children:(0,i.jsx)(c.Z,{color:"text.secondary",children:"알림이 없습니다."})})]})})}},47990:function(t,e,n){"use strict";var i=n(83464);let r=i.Z.create({baseURL:"http://localhost:9999",withCredentials:!0});r.interceptors.request.use(t=>t,t=>Promise.reject(t)),r.interceptors.response.use(t=>t,async t=>{var e;let n=t.config;if("/api/auth/refresh"===n.url)return window.location.href="/login",Promise.reject(t);if((null===(e=t.response)||void 0===e?void 0:e.status)===401&&!n._retry){n._retry=!0;try{return await i.Z.post("".concat("http://localhost:9999","/api/auth/refresh"),{},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),r(n)}catch(t){return window.location.href="/login",Promise.reject(t)}}return Promise.reject(t)}),e.Z=r},83076:function(t,e,n){"use strict";n.d(e,{FY:function(){return r},Go:function(){return c},Ix:function(){return s},kW:function(){return o},no:function(){return u},xQ:function(){return a}});var i=n(47990);let r=async()=>(await i.Z.get("".concat("http://localhost:9999","/api/notifications"),{withCredentials:!0})).data.filter(t=>"comment"===t.type||"reply"===t.type),a=async()=>(await i.Z.get("".concat("http://localhost:9999","/api/notifications"),{withCredentials:!0})).data.filter(t=>"channel_post"===t.type),o=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(await i.Z.get("".concat("http://localhost:9999","/api/notifications/all"),{params:{page:t,limit:e},withCredentials:!0})).data},s=async t=>{await i.Z.patch("".concat("http://localhost:9999","/api/notifications/").concat(t,"/read"),{},{withCredentials:!0})},c=async()=>{await i.Z.patch("".concat("http://localhost:9999","/api/notifications/read-all"),{},{withCredentials:!0})},u=async t=>{await i.Z.delete("".concat("http://localhost:9999","/api/notifications/").concat(t),{withCredentials:!0})}},11471:function(t,e,n){"use strict";n.d(e,{D$:function(){return i},Tq:function(){return r},VI:function(){return s},bP:function(){return o},jL:function(){return a},oi:function(){return c}});let i=6,r=6,a=1,o=6,s=6,c=5}},function(t){t.O(0,[5152,4419,1991,1547,6593,9631,605,7037,1256,7571,6476,8921,9795,2971,2117,1744],function(){return t(t.s=8113)}),_N_E=t.O()}]);