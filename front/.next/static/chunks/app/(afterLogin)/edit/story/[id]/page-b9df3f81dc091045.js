(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9739],{53843:function(e,t,a){Promise.resolve().then(a.bind(a,44944))},44944:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var o=a(57437),r=a(2265),c=a(99376),n=a(29827),l=a(16593),i=a(21770),s=a(83464),d=a(2069),p=a(46387),u=a(97404),g=a(91991),h=a(35389),f=a(94623),x=a(87761),b=a(86874),m=a(72317),v=a(80605),y=a(30419);function k(e){let{params:t}=e,a=(0,n.NL)(),k=(0,c.useRouter)(),{data:j,status:E}=(0,v.useSession)(),{showMessage:$}=(0,y.U)(e=>e),[C,S]=(0,r.useState)(""),[Z,w]=(0,r.useState)(""),[R,_]=(0,r.useState)(b.E2),[D,F]=(0,r.useState)([]),[I,U]=(0,r.useState)(!1),{data:z,isLoading:A}=(0,l.a)({queryKey:["story","edit",null==t?void 0:t.id],queryFn:async()=>{try{return(await s.Z.get("".concat("http://localhost:9999","/api/story/detail/edit/").concat(t.id,"?userId=").concat(null==j?void 0:j.user.id),{withCredentials:!0})).data}catch(t){var e;throw s.Z.isAxiosError(t)&&(null===(e=t.response)||void 0===e?void 0:e.status)===403&&k.push("/"),t}},retry:1,retryDelay:()=>2e3,enabled:!!t.id&&!!(null==j?void 0:j.user.id)});(0,r.useEffect)(()=>{"unauthenticated"===E&&k.push("/")},[E,k]),(0,r.useEffect)(()=>{if(z){S(z.title||"");let e=z.content||"",t="http://localhost:9999";t&&z.StoryImage&&z.StoryImage.length>0&&z.StoryImage.forEach((a,o)=>{let r=a.image_name.replace(/_\d{8}\.(jpg|jpeg|png|gif|webp)$/i,""),c=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=(e=(e=(e=e.replace(RegExp('alt="'.concat(c,'[^"]*"[^>]*src="blob:[^"]*"'),"gi"),'alt="'.concat(r,'.jpg" src="').concat(t).concat(a.link,'"'))).replace(RegExp('title="'.concat(c,'[^"]*"[^>]*src="blob:[^"]*"'),"gi"),'title="'.concat(r,'.jpg" src="').concat(t).concat(a.link,'"'))).replace(RegExp('src="blob:[^"]*"[^>]*alt="'.concat(c,'[^"]*"'),"gi"),'src="'.concat(t).concat(a.link,'" alt="').concat(r,'.jpg"'))).replace(RegExp('src="blob:[^"]*"[^>]*title="'.concat(c,'[^"]*"'),"gi"),'src="'.concat(t).concat(a.link,'" title="').concat(r,'.jpg"'))}),t&&z.StoryVideo&&z.StoryVideo.length>0&&z.StoryVideo.forEach((a,o)=>{e=(e=(e=(e=e.replace(/<source([^>]*)src=""([^>]*)/g,'<source$1src="'.concat(t).concat(a.link,'"$2'))).replace(/<source([^>]*)src="blob:[^"]*"([^>]*)/g,'<source$1src="'.concat(t).concat(a.link,'"$2'))).replace(/<video([^>]*)src=""([^>]*)/g,'<video$1src="'.concat(t).concat(a.link,'"$2'))).replace(/<video([^>]*)src="blob:[^"]*"([^>]*)/g,'<video$1src="'.concat(t).concat(a.link,'"$2'));let r=a.file_size?(a.file_size/1024/1024).toFixed(2):"0.00",c="\uD83C\uDFAC ".concat(a.video_name," (").concat(r,"MB)");e=(e=e.replace(/🎬\s+[^(]+\([^)]+MB\)/g,c)).replace(/🎬[^<]+(?=<)/g,c)}),t&&(e=(e=e.replace(/src="\/upload\/([^"]+)"/g,'src="'.concat(t,'/upload/$1"'))).replace(/src="\/videoUpload\/([^"]+)"/g,'src="'.concat(t,'/videoUpload/$1"'))),w(e),_(z.category||b.E2)}},[z]);let W=(0,i.D)({mutationFn:async e=>{await s.Z.post("".concat("http://localhost:9999","/api/story/update/").concat(t.id),e,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}})},retry:1,retryDelay:()=>2e3,onSuccess:()=>{var e;U(!1),$("수정 성공","success"),a.invalidateQueries({queryKey:["story","detail",t.id]}),(null==z?void 0:null===(e=z.Channel)||void 0===e?void 0:e.slug)?k.push("/channels/".concat(z.Channel.slug,"/detail/story/").concat(t.id)):k.push("/")},onError:e=>{U(!1),$("수정 실패, 이전 화면으로 이동합니다","error"),console.error(e),k.back()}});return A?(0,o.jsx)(f.default,{}):(0,o.jsxs)(d.Z,{padding:4,component:"form",sx:{width:"60%",margin:"auto",mt:5,bgcolor:"background.paper",boxShadow:3,borderRadius:3,mb:5},children:[(0,o.jsx)(p.Z,{variant:"h4",marginBottom:3,sx:{fontWeight:"bold",textAlign:"center",color:"primary.main"},children:"글 수정하기"}),(0,o.jsx)(u.Z,{name:"title",label:"제목 (필수)",variant:"outlined",fullWidth:!0,margin:"normal",value:C,onChange:e=>S(e.target.value),sx:{bgcolor:"background.default",borderRadius:2,mb:2}}),(0,o.jsx)(m.Z,{selectArray:b.KX,defaultValue:b.E2,setSelectedCategory:_,value:R}),(0,o.jsxs)(d.Z,{sx:{mb:2},children:[(0,o.jsx)(p.Z,{variant:"body1",sx:{mb:1,fontWeight:500,mt:-1},children:"내용 (필수)"}),(0,o.jsx)(x.Z,{value:Z,onChange:w,placeholder:"글 내용을 입력해주세요",height:"400px",onFilesChange:e=>{F(e)}})]}),(0,o.jsxs)(d.Z,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[(0,o.jsx)(g.Z,{variant:"outlined",color:"error",onClick:()=>k.back(),sx:{flex:1,marginRight:1,fontWeight:"bold"},children:"취소"}),(0,o.jsx)(g.Z,{variant:"contained",color:"success",onClick:e=>{if(C.length<3||Z.length<3){$("제목과 내용을 3글자 이상 입력해주세요","error");return}U(!0),e.preventDefault();let t=new FormData;t.append("title",C);let a=Z,o="http://localhost:9999";if(o){let e=o.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),t=RegExp('src="'.concat(e,'/upload/([^"]+)"'),"g");Z.match(t),a=a.replace(t,'src="/upload/$1"');let r=RegExp('src="'.concat(e,'/videoUpload/([^"]+)"'),"g");Z.match(r),a=a.replace(r,'src="/videoUpload/$1"');let c=RegExp('<source([^>]*)src="'.concat(e,'/videoUpload/([^"]+)"([^>]*)>'),"g");Z.match(c),a=a.replace(c,'<source$1src="/videoUpload/$2"$3>');let n=/src="blob:[^"]*"/g;Z.match(n),a=a.replace(n,'src=""')}t.append("content",a),t.append("category",R),D.forEach(e=>{t.append("files",e)}),Array.from(t.entries()).forEach(e=>{let[t,a]=e}),W.mutate(t)},disabled:I||C.length<3||Z.length<3,sx:{flex:1,marginLeft:1,fontWeight:"bold"},startIcon:I&&(0,o.jsx)(h.Z,{size:20,color:"inherit"}),children:"수정"})]})]})}},94623:function(e,t,a){"use strict";a.d(t,{default:function(){return n}});var o=a(57437),r=a(35389),c=a(31691);function n(){let e=(0,c.Z)();return(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"dark"===e.palette.mode?"rgba(18, 18, 18, 0.3)":"rgba(255, 255, 255, 0.3)",backdropFilter:"blur(1px)",zIndex:9999,display:"flex",justifyContent:"center",alignItems:"center",transition:"background-color 0.3s ease"},children:(0,o.jsxs)("div",{style:{textAlign:"center",backgroundColor:"dark"===e.palette.mode?"#1e1e1e":"#ffffff",padding:"24px 32px",borderRadius:"12px",boxShadow:"dark"===e.palette.mode?"0 8px 24px rgba(0, 0, 0, 0.5)":"0 8px 24px rgba(0, 0, 0, 0.15)",border:"dark"===e.palette.mode?"1px solid #333333":"1px solid #e0e0e0"},children:[(0,o.jsx)(r.Z,{size:48,thickness:4,sx:{color:"dark"===e.palette.mode?"#bb86fc":"#1976d2",marginBottom:1}}),(0,o.jsx)("div",{style:{marginTop:"12px",fontSize:"14px",color:"dark"===e.palette.mode?"#e0e0e0":"#666666",fontWeight:500},children:"로딩 중..."})]})})}a(2265)}},function(e){e.O(0,[3572,7902,5152,4419,1991,1547,6593,455,2472,7404,9631,605,7037,5679,4636,7799,9859,2971,2117,1744],function(){return e(e.s=53843)}),_N_E=e.O()}]);