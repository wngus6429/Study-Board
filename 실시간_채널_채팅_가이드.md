# ğŸ“± ì‹¤ì‹œê°„ ì±„ë„ ì±„íŒ… ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨

- [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
- [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
- [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
- [ë°±ì—”ë“œ êµ¬ì¡°](#ë°±ì—”ë“œ-êµ¬ì¡°)
- [í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°](#í”„ë¡ íŠ¸ì—”ë“œ-êµ¬ì¡°)
- [í•µì‹¬ ê¸°ëŠ¥](#í•µì‹¬-ê¸°ëŠ¥)
- [ì„¤ì¹˜ ë° ì‹¤í–‰](#ì„¤ì¹˜-ë°-ì‹¤í–‰)
- [API ëª…ì„¸](#api-ëª…ì„¸)
- [WebSocket ì´ë²¤íŠ¸](#websocket-ì´ë²¤íŠ¸)
- [íŒŒì¼ êµ¬ì¡°](#íŒŒì¼-êµ¬ì¡°)
- [ì£¼ìš” íŠ¹ì§•](#ì£¼ìš”-íŠ¹ì§•)
- [ì¶”í›„ ê°œì„  ì‚¬í•­](#ì¶”í›„-ê°œì„ -ì‚¬í•­)

---

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

Study-Board ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì‹¤ì‹œê°„ ì±„ë„ ì±„íŒ… ê¸°ëŠ¥ì„ ì¶”ê°€í•œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
ì‚¬ìš©ìë“¤ì´ íŠ¹ì • ì±„ë„ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ëŒ€í™”í•  ìˆ˜ ìˆìœ¼ë©°, ë©”ì‹œì§€ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì˜êµ¬ ì €ì¥ë©ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

- âœ… ì‹¤ì‹œê°„ ì±„íŒ… (WebSocket ê¸°ë°˜)
- âœ… ë©”ì‹œì§€ ì˜êµ¬ ì €ì¥ (MySQL)
- âœ… ì‚¬ìš©ì ì¸ì¦ ë° ì„¸ì…˜ ê´€ë¦¬
- âœ… ì±„ë„ë³„ ì±„íŒ…ë°© ë¶„ë¦¬
- âœ… ë°˜ì‘í˜• UI ë””ìì¸
- âœ… ì—°ê²° ìƒíƒœ í‘œì‹œ
- âœ… ë©”ì‹œì§€ ì‚­ì œ (ë³¸ì¸ ë©”ì‹œì§€ë§Œ)
- âœ… ì˜¨ë¼ì¸ ì‚¬ìš©ì ìˆ˜ í‘œì‹œ

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### ë°±ì—”ë“œ

- **NestJS**: Node.js í”„ë ˆì„ì›Œí¬
- **Socket.io**: WebSocket ì‹¤ì‹œê°„ í†µì‹ 
- **TypeORM**: ë°ì´í„°ë² ì´ìŠ¤ ORM
- **MySQL**: ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤
- **JWT**: ì‚¬ìš©ì ì¸ì¦

### í”„ë¡ íŠ¸ì—”ë“œ

- **React**: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤
- **Next.js**: React í”„ë ˆì„ì›Œí¬
- **Material-UI**: UI ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **Socket.io-client**: WebSocket í´ë¼ì´ì–¸íŠ¸
- **TypeScript**: ì •ì  íƒ€ì… ì§€ì›

---

## ğŸ—ƒï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### ChannelChatMessage ì—”í‹°í‹°

```typescript
interface ChannelChatMessage {
  id: number; // ë©”ì‹œì§€ ê³ ìœ  ID
  message: string; // ë©”ì‹œì§€ ë‚´ìš© (ìµœëŒ€ 1000ì)
  created_at: Date; // ìƒì„± ì‹œê°„
  updated_at: Date; // ìˆ˜ì • ì‹œê°„

  // ê´€ê³„
  channel: Channel; // ì†Œì† ì±„ë„
  user: User; // ì‘ì„±ì

  // ì™¸ë˜í‚¤
  channel_id: number;
  user_id: number;
}
```

### ì¸ë±ìŠ¤ ìµœì í™”

- `IDX_channel_created`: (channel_id, created_at) - ì±„ë„ë³„ ìµœì‹  ë©”ì‹œì§€ ì¡°íšŒ ìµœì í™”

---

## ğŸ—ï¸ ë°±ì—”ë“œ êµ¬ì¡°

### ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/channel-chat/
â”œâ”€â”€ channel-chat.module.ts      # ëª¨ë“ˆ ì •ì˜
â”œâ”€â”€ channel-chat.service.ts     # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€ channel-chat.controller.ts  # REST API ì»¨íŠ¸ë¡¤ëŸ¬
â””â”€â”€ channel-chat.gateway.ts     # WebSocket ê²Œì´íŠ¸ì›¨ì´
```

### í•µì‹¬ ì„œë¹„ìŠ¤ (ChannelChatService)

```typescript
class ChannelChatService {
  // ì±„íŒ… ë©”ì‹œì§€ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)
  getChannelChatMessages(channelId, page, limit);

  // ë©”ì‹œì§€ ì „ì†¡
  sendChannelChatMessage(channelId, userId, message);

  // ë©”ì‹œì§€ ì‚­ì œ (ë³¸ì¸ë§Œ)
  deleteChannelChatMessage(messageId, userId);

  // ì±„ë„ ì…ì¥/í‡´ì¥
  joinChannelChat(channelId, userId);
  leaveChannelChat(channelId, userId);
}
```

### WebSocket ê²Œì´íŠ¸ì›¨ì´ ì´ë²¤íŠ¸

- `join_channel`: ì±„ë„ ì…ì¥
- `leave_channel`: ì±„ë„ í‡´ì¥
- `send_message`: ë©”ì‹œì§€ ì „ì†¡
- `typing`: ì…ë ¥ ì¤‘ ìƒíƒœ

---

## ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸

```typescript
// ì±„íŒ… ìƒíƒœ ê´€ë¦¬
const [showChat, setShowChat] = useState(false);
const [chatMessages, setChatMessages] = useState<ChannelChatMessage[]>([]);
const [newMessage, setNewMessage] = useState("");
const [onlineCount, setOnlineCount] = useState(0);
```

### WebSocket í´ë˜ìŠ¤ (utils/websocket.ts)

```typescript
class ChannelChatWebSocket {
  connect(channelId, user); // ì±„ë„ ì—°ê²°
  disconnect(); // ì—°ê²° í•´ì œ
  sendMessage(message); // ë©”ì‹œì§€ ì „ì†¡
  onMessage(callback); // ë©”ì‹œì§€ ìˆ˜ì‹  ì½œë°±
  onStatusChange(callback); // ìƒíƒœ ë³€ê²½ ì½œë°±
}
```

### UI í† ê¸€ ì‹œìŠ¤í…œ

- ì¼ë°˜ ëª¨ë“œ: ê²Œì‹œê¸€/ëŒ“ê¸€ í‘œì‹œ
- ì±„íŒ… ëª¨ë“œ: ì‹¤ì‹œê°„ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤
- Material-UI Drawer ë°©ì‹ì—ì„œ ì „ì²´ í™”ë©´ ë°©ì‹ìœ¼ë¡œ ë³€ê²½

---

## âš¡ í•µì‹¬ ê¸°ëŠ¥

### 1. ì‹¤ì‹œê°„ ë©”ì‹œì§•

- WebSocketì„ í†µí•œ ì¦‰ì‹œ ë©”ì‹œì§€ ì „ë‹¬
- ì±„ë„ë³„ ë…ë¦½ì ì¸ ì±„íŒ…ë°©
- ìë™ ì¬ì—°ê²° ê¸°ëŠ¥ (ìµœëŒ€ 5íšŒ)

### 2. ë©”ì‹œì§€ ê´€ë¦¬

- ë©”ì‹œì§€ ì˜êµ¬ ì €ì¥ (MySQL)
- í˜ì´ì§€ë„¤ì´ì…˜ ì§€ì› (ê¸°ë³¸ 50ê°œì”©)
- ë³¸ì¸ ë©”ì‹œì§€ ì‚­ì œ ê°€ëŠ¥
- 1000ì ì œí•œ

### 3. ì‚¬ìš©ì ê´€ë¦¬

- JWT í† í° ê¸°ë°˜ ì¸ì¦
- ë‹‰ë„¤ì„ í‘œì‹œ
- ì˜¨ë¼ì¸ ì‚¬ìš©ì ìˆ˜ ì‹¤ì‹œê°„ í‘œì‹œ
- ì„¸ì…˜ ê´€ë¦¬

### 4. UI/UX

- ë°˜ì‘í˜• ë””ìì¸
- Material-UI ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- ì—°ê²° ìƒíƒœ ì¸ë””ì¼€ì´í„°
- ìŠ¤í¬ë¡¤ ìë™ ì¡°ì •

---

## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰

### ë°±ì—”ë“œ ì„¤ì •

```bash
cd back
npm install @nestjs/websockets@^10.0.0 @nestjs/platform-socket.io@^10.0.0 socket.io@^4.7.0 --legacy-peer-deps
npm run start:dev
```

### í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •

```bash
cd front
npm install socket.io-client
npm run dev
```

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```env
# front/.env.local
NEXT_PUBLIC_WEBSOCKET_URL=http://localhost:3001
```

---

## ğŸ“¡ API ëª…ì„¸

### REST API ì—”ë“œí¬ì¸íŠ¸

#### ë©”ì‹œì§€ ì¡°íšŒ

```
GET /channel-chat/:channelId/messages?page=1&limit=50
```

#### ë©”ì‹œì§€ ì „ì†¡

```
POST /channel-chat/:channelId/messages
Body: { message: string }
```

#### ë©”ì‹œì§€ ì‚­ì œ

```
DELETE /channel-chat/messages/:messageId
```

#### ì±„ë„ ì…ì¥

```
POST /channel-chat/:channelId/join
```

#### ì±„ë„ í‡´ì¥

```
POST /channel-chat/:channelId/leave
```

### ì‘ë‹µ í˜•ì‹

```typescript
interface ChannelChatResponse {
  success: boolean;
  data: ChannelChatMessage[];
  pagination?: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
  };
}
```

---

## ğŸ”Œ WebSocket ì´ë²¤íŠ¸

### í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„

| ì´ë²¤íŠ¸ëª…        | ë°ì´í„°                    | ì„¤ëª…        |
| --------------- | ------------------------- | ----------- |
| `join_channel`  | `{ channelId, user }`     | ì±„ë„ ì…ì¥   |
| `leave_channel` | `{ channelId }`           | ì±„ë„ í‡´ì¥   |
| `send_message`  | `{ channelId, message }`  | ë©”ì‹œì§€ ì „ì†¡ |
| `typing`        | `{ channelId, isTyping }` | ì…ë ¥ ìƒíƒœ   |

### ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸

| ì´ë²¤íŠ¸ëª…      | ë°ì´í„°                  | ì„¤ëª…        |
| ------------- | ----------------------- | ----------- |
| `new_message` | `ChannelChatMessage`    | ìƒˆ ë©”ì‹œì§€   |
| `user_joined` | `{ user, onlineCount }` | ì‚¬ìš©ì ì…ì¥ |
| `user_left`   | `{ user, onlineCount }` | ì‚¬ìš©ì í‡´ì¥ |
| `user_typing` | `{ user, isTyping }`    | ì…ë ¥ ìƒíƒœ   |
| `error`       | `{ message }`           | ì˜¤ë¥˜ ë°œìƒ   |

---

## ğŸ“‚ íŒŒì¼ êµ¬ì¡°

```
Study-Board/
â”œâ”€â”€ back/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ ChannelChatMessage.entity.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Channels.entity.ts (ìˆ˜ì •)
â”‚   â”‚   â”‚   â””â”€â”€ user.entity.ts (ìˆ˜ì •)
â”‚   â”‚   â”œâ”€â”€ channel-chat/
â”‚   â”‚   â”‚   â”œâ”€â”€ channel-chat.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ channel-chat.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ channel-chat.controller.ts
â”‚   â”‚   â”‚   â””â”€â”€ channel-chat.gateway.ts
â”‚   â”‚   â””â”€â”€ app.module.ts (ìˆ˜ì •)
â”‚   â””â”€â”€ package.json (ì˜ì¡´ì„± ì¶”ê°€)
â””â”€â”€ front/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ app/
    â”‚   â”‚   â”œâ”€â”€ (noLogin)/channels/[slug]/page.tsx (ìˆ˜ì •)
    â”‚   â”‚   â””â”€â”€ api/channelChatApi.ts
    â”‚   â””â”€â”€ utils/
    â”‚       â””â”€â”€ websocket.ts
    â””â”€â”€ package.json (ì˜ì¡´ì„± ì¶”ê°€)
```

---

## âœ¨ ì£¼ìš” íŠ¹ì§•

### 1. í™•ì¥ì„±

- ëª¨ë“ˆí™”ëœ êµ¬ì¡°ë¡œ ì‰¬ìš´ ê¸°ëŠ¥ ì¶”ê°€
- TypeORMìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ìš©ì´
- RESTful APIì™€ WebSocket ì´ì¤‘ ì§€ì›

### 2. ì•ˆì •ì„±

- ìë™ ì¬ì—°ê²° ê¸°ëŠ¥
- ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…
- ë°±ì—… API í˜¸ì¶œ (WebSocket ì‹¤íŒ¨ ì‹œ)

### 3. ì„±ëŠ¥

- ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìµœì í™”
- í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
- Socket.io ë£¸ì„ í†µí•œ íš¨ìœ¨ì ì¸ ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŒ…

### 4. ë³´ì•ˆ

- JWT í† í° ì¸ì¦
- ë³¸ì¸ ë©”ì‹œì§€ë§Œ ì‚­ì œ ê°€ëŠ¥
- SQL ì¸ì ì…˜ ë°©ì§€ (TypeORM)

---

## ğŸ”® ì¶”í›„ ê°œì„  ì‚¬í•­

### ë‹¨ê¸° ê°œì„ 

- [ ] ë©”ì‹œì§€ í¸ì§‘ ê¸°ëŠ¥
- [ ] ì´ë¯¸ì§€/íŒŒì¼ ì „ì†¡
- [ ] ì´ëª¨ì§€ ë°˜ì‘
- [ ] ë©˜ì…˜ ê¸°ëŠ¥ (@ì‚¬ìš©ìëª…)

### ì¤‘ê¸° ê°œì„ 

- [ ] ë©”ì‹œì§€ ê²€ìƒ‰ ê¸°ëŠ¥
- [ ] ì±„íŒ… í…Œë§ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- [ ] ì•Œë¦¼ ì„¤ì •
- [ ] ëª¨ë°”ì¼ ì•± í‘¸ì‹œ ì•Œë¦¼

### ì¥ê¸° ê°œì„ 

- [ ] ìŒì„±/ì˜ìƒ í†µí™”
- [ ] í™”ë©´ ê³µìœ 
- [ ] ë´‡ ì—°ë™ (ChatGPT ë“±)
- [ ] ë©”ì‹œì§€ ì•”í˜¸í™”

---

## ğŸ†˜ ë¬¸ì œ í•´ê²°

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œ

1. **WebSocket ì—°ê²° ì‹¤íŒ¨**

   - CORS ì„¤ì • í™•ì¸
   - í¬íŠ¸ ì¶©ëŒ í™•ì¸ (3001)
   - í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í™•ì¸

2. **ë©”ì‹œì§€ê°€ ì•ˆ ë³´ì„**

   - ì¸ì¦ í† í° í™•ì¸
   - ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ í™•ì¸
   - ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬ í™•ì¸

3. **ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜**
   - MySQL ì—°ê²° ì„¤ì • í™•ì¸
   - í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
   - ì™¸ë˜í‚¤ ì œì•½ ì¡°ê±´ í™•ì¸

---

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

ê°œë°œ ê³¼ì •ì—ì„œ ìƒê¸´ íŒŒì¼ë“¤:

- `back/src/channel-chat/` - ë°±ì—”ë“œ ì±„íŒ… ëª¨ë“ˆ
- `front/src/app/api/channelChatApi.ts` - API í´ë¼ì´ì–¸íŠ¸
- `front/src/app/utils/websocket.ts` - WebSocket í´ë¼ì´ì–¸íŠ¸

ì´ ë¬¸ì„œëŠ” ì‹¤ì‹œê°„ ì±„ë„ ì±„íŒ… ì‹œìŠ¤í…œì˜ ì „ì²´ì ì¸ êµ¬ì¡°ì™€ ì‚¬ìš©ë²•ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
ì¶”ê°€ ì§ˆë¬¸ì´ë‚˜ ê¸°ëŠ¥ ê°œì„ ì´ í•„ìš”í•˜ë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš”! ğŸš€
