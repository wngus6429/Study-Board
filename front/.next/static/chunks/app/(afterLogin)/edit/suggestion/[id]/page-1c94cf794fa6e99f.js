(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5656],{7213:function(e,t,a){Promise.resolve().then(a.bind(a,94586))},94586:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var n=a(57437),o=a(2265),r=a(99376),i=a(29827),c=a(16593),l=a(21770),s=a(83464),d=a(2069),g=a(46387),u=a(97404),p=a(91991),h=a(35389),f=a(94623),x=a(87761),b=a(72317),m=a(86874),y=a(80605),k=a(30419);function v(e){let{params:t}=e,a=(0,i.NL)(),v=(0,r.useRouter)(),{data:j,status:C}=(0,y.useSession)(),{showMessage:E}=(0,k.U)(e=>e),[Z,w]=(0,o.useState)(""),[S,R]=(0,o.useState)(""),[_,I]=(0,o.useState)(m.ey),[$,W]=(0,o.useState)([]),[A,D]=(0,o.useState)(!1),{data:F,isLoading:U}=(0,c.a)({queryKey:["suggestion","edit",null==t?void 0:t.id],queryFn:async()=>{try{return(await s.Z.get("".concat("http://localhost:9999","/api/suggestion/detail/edit/").concat(t.id,"?userId=").concat(null==j?void 0:j.user.id),{withCredentials:!0})).data}catch(t){var e;throw console.error("Error fetching suggestion detail",t),s.Z.isAxiosError(t)&&(null===(e=t.response)||void 0===e?void 0:e.status)===403&&v.push("/"),t}},retry:1,retryDelay:()=>2e3,enabled:!!t.id&&!!(null==j?void 0:j.user.id)});(0,o.useEffect)(()=>{if(F){w(F.title||"");let e=F.content||"",t="http://localhost:9999";t&&F.SuggestionImage&&F.SuggestionImage.length>0&&F.SuggestionImage.forEach((a,n)=>{let o=a.image_name.replace(/_\d{8}\.(jpg|jpeg|png|gif|webp)$/i,""),r=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=(e=(e=(e=e.replace(RegExp('alt="'.concat(r,'[^"]*"[^>]*src="blob:[^"]*"'),"gi"),'alt="'.concat(o,'.jpg" src="').concat(t).concat(a.link,'"'))).replace(RegExp('title="'.concat(r,'[^"]*"[^>]*src="blob:[^"]*"'),"gi"),'title="'.concat(o,'.jpg" src="').concat(t).concat(a.link,'"'))).replace(RegExp('src="blob:[^"]*"[^>]*alt="'.concat(r,'[^"]*"'),"gi"),'src="'.concat(t).concat(a.link,'" alt="').concat(o,'.jpg"'))).replace(RegExp('src="blob:[^"]*"[^>]*title="'.concat(r,'[^"]*"'),"gi"),'src="'.concat(t).concat(a.link,'" title="').concat(o,'.jpg"'))}),t&&(e=e.replace(/src="\/suggestionUpload\/([^"]+)"/g,'src="'.concat(t,'/suggestionUpload/$1"'))),R(e),I(F.category||m.ey)}},[F]),(0,o.useEffect)(()=>{"unauthenticated"===C&&v.push("/")},[C,v]);let z=(0,l.D)({mutationFn:async e=>{await s.Z.post("".concat("http://localhost:9999","/api/suggestion/update/").concat(t.id),e,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}})},retry:1,retryDelay:()=>2e3,onSuccess:()=>{D(!1),E("수정 성공","success"),a.invalidateQueries({queryKey:["suggestion","detail",t.id]}),v.back()},onError:e=>{D(!1),E("수정 실패, 이전 화면으로 이동합니다","error"),console.error(e),v.back()}}),N=e=>{if(Z.length<3||S.length<3){E("제목과 내용을 3글자 이상 입력해주세요","error");return}D(!0),e.preventDefault();let t=new FormData;t.append("title",Z);let a=S,n="http://localhost:9999";if(n){let e=n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");a=(a=a.replace(RegExp('src="'.concat(e,'/suggestionUpload/([^"]+)"'),"g"),'src="/suggestionUpload/$1"')).replace(/src="blob:[^"]*"/g,'src=""')}t.append("content",a),t.append("category",_),$.forEach(e=>{t.append("images",e)}),Array.from(t.entries()).forEach(e=>{let[t,a]=e}),z.mutate(t)};return U?(0,n.jsx)(f.default,{}):(0,n.jsxs)(d.Z,{component:"form",onSubmit:N,padding:4,sx:{width:"60%",margin:"auto",mt:5,bgcolor:"background.paper",boxShadow:3,borderRadius:3,mb:5},children:[(0,n.jsx)(g.Z,{variant:"h4",marginBottom:3,sx:{fontWeight:"bold",textAlign:"center",color:"primary.main"},children:"건의사항 수정하기"}),(0,n.jsx)(u.Z,{name:"title",label:"제목 (필수)",variant:"outlined",fullWidth:!0,margin:"normal",value:Z,onChange:e=>w(e.target.value),sx:{bgcolor:"background.default",borderRadius:2,mb:2}}),(0,n.jsx)(b.Z,{selectArray:m.CQ,defaultValue:m.ey,setSelectedCategory:I,value:_}),(0,n.jsxs)(d.Z,{sx:{mb:2},children:[(0,n.jsx)(g.Z,{variant:"body1",sx:{mb:1,fontWeight:500,mt:-1},children:"내용 (필수)"}),(0,n.jsx)(x.Z,{value:S,onChange:R,placeholder:"건의사항 내용을 입력해주세요",height:"400px",onFilesChange:e=>{W(e)}})]}),(0,n.jsxs)(d.Z,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[(0,n.jsx)(p.Z,{variant:"outlined",color:"error",onClick:()=>v.back(),sx:{flex:1,marginRight:1,fontWeight:"bold"},children:"취소"}),(0,n.jsx)(p.Z,{variant:"contained",color:"success",onClick:N,disabled:A||Z.length<3||S.length<3,sx:{flex:1,marginLeft:1,fontWeight:"bold"},startIcon:A&&(0,n.jsx)(h.Z,{size:20,color:"inherit"}),children:"수정"})]})]})}},94623:function(e,t,a){"use strict";a.d(t,{default:function(){return i}});var n=a(57437),o=a(35389),r=a(31691);function i(){let e=(0,r.Z)();return(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"dark"===e.palette.mode?"rgba(18, 18, 18, 0.3)":"rgba(255, 255, 255, 0.3)",backdropFilter:"blur(1px)",zIndex:9999,display:"flex",justifyContent:"center",alignItems:"center",transition:"background-color 0.3s ease"},children:(0,n.jsxs)("div",{style:{textAlign:"center",backgroundColor:"dark"===e.palette.mode?"#1e1e1e":"#ffffff",padding:"24px 32px",borderRadius:"12px",boxShadow:"dark"===e.palette.mode?"0 8px 24px rgba(0, 0, 0, 0.5)":"0 8px 24px rgba(0, 0, 0, 0.15)",border:"dark"===e.palette.mode?"1px solid #333333":"1px solid #e0e0e0"},children:[(0,n.jsx)(o.Z,{size:48,thickness:4,sx:{color:"dark"===e.palette.mode?"#bb86fc":"#1976d2",marginBottom:1}}),(0,n.jsx)("div",{style:{marginTop:"12px",fontSize:"14px",color:"dark"===e.palette.mode?"#e0e0e0":"#666666",fontWeight:500},children:"로딩 중..."})]})})}a(2265)}},function(e){e.O(0,[3572,7902,5152,4419,1991,1547,6593,455,2472,7404,9631,605,7037,5679,4636,7799,9859,2971,2117,1744],function(){return e(e.s=7213)}),_N_E=e.O()}]);